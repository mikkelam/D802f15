\subsection{Choosing features}\label{sec:choosingfeatures}
In the following, we aim to define the features $\phi_j(x)$ for each LoL match $x$, as described in \Cref{sec:phi}.
We define 5 different types of features and argue argue why each type is a good candidates for predicting the winning team.
The different types of features are each extracted by a mapping function, that maps a LoL match (in some cases with additional parameters) to a value. 
Before the feature mappings are defined, convenient notations are introduced that mathematically describes the concept of a game.
$C = \{1, 2, \dots, m\}$ is the set of all champions, where each champion is represented by an id. $m = 124$ for the patch version of LoL used in this project.
$P = \{p_1, p_2, \dots\}$ denotes the set of all players.
$\text{TEAMS} = \{\text{blue}, \text{purple}\}$ are the two teams.
$T_i(x) = \{ (p, c) \in P \times C \mid c \text{ is controlled by } p \text{ on team } i  \text{ in match } x \}$, where $i \in \text{TEAMS}$.\\
$R = \{\text{unranked},\text{bronze},\text{silver},\text{gold},\text{platinum},\text{diamond},\text{master},\text{challenger}\}$ is the set of ranks.
$L = \{\text{top},\text{bottom},\text{mid},\text{jungle}\}$ is the set of lanes.

\subsubsection{Single champions}
Some champions may be better than other champions. To capture the strength of individual champions, we define features that represent the presence or absence of a particular champion on each team.
$\forall t \in \text{TEAMS}, \forall c \in C:$
\begin{equation}\label{eq:single}  
\phi_{\text{SINGLE}, t, c}(x) = 
\begin{cases} 
  1 & \text{if } (c, p) \in T_t(x) \text{ for some } p \\
  0 & \text{otherwise} 
\end{cases}
\end{equation}


\subsubsection{Champion pairs}
Some champions are considered damage dealers. They deal very high damage, but die easily. Other champions deal very little damage, but can be almost impossible to kill - these are considered tanks. These two types of champions are weak when alone, but when they team up, they can pose a serious threat. The tank can be used by the damage dealer as a living shield, allowing him to stay alive for much longer, thus deal more damage.
To capture the synergy between two champions on the same team, we define features that represent the presence or absence of every 2-combination of champions on that team. $\forall t \in \text{TEAMS}, \forall c_1, c_2 \in C$ where $c_1 < c_2$:
\begin{equation}\label{eq:pair}
\phi_{\text{PAIR}, t, c_1, c_2}(x) =
\begin{cases}
  1 & \text{if } (c_1, p_1), (c_2, p_2) \in T_t(x) \text{ for some }p_1, p_2\\
  0 & \text{otherwise}
\end{cases}
\end{equation}

We make the restriction $c_1 < c_2$, because we want to ignore permutations. This is because the two features $x_\text{PAIR}(t, c_1, c_2)$ and $x_\text{PAIR}(t, c_2, c_1)$ are the same, since they both capture that the two champions $c_1$ and $c_2$ are present on team $t$.

\subsubsection{Champion counters}
Some champions may have an advantage when fighting against a particular opponent.
For instance, a champion that is good at dodging ranged attacks is good against an enemy that only has ranged attacks.
We say that the better suited champion \emph{counters} the other.
To capture that one champion may counter another, we will for each champion on team $t$ need a feature that represents the presence or absence of every possible champion on the other team. $\forall c_1, c_2 \in C:$
\begin{equation}\label{eq:counter}
\phi_{\text{COUNTER},c_1,c_2}(x) = 
\begin{cases} 
1 & \text{if } (c_1, p_1) \in T_\text{blue}(x) \text{ and } (c_2, p_2) \in T_\text{purple}(x) \text{ for some } p_1, p_2 \\ 
0 & \text{otherwise} 
\end{cases}
\end{equation}

For this type of feature, we do not have the restriction $c_1 < c_2$ and thus consider permutations instead of combinations.
To understand why, consider that $c_1$ counters $c_2$.
In this case, the feature $\phi_{\text{COUNTER},c_1,c_2}(x) = 1$ is favorable to the blue team, while $\phi_{\text{COUNTER},c_2,c_1}(x) = 1$ is favorable to the red team.
Note that in some game modes, $\phi_{\text{COUNTER},c_1,c_2}(x) = 1$, is allowed for $c_1 = c_2$. That is, the same champion may appear on both teams.
In that way we can capture if a champion can counter itself due to some asymmetries in the map layout.

\subsubsection{Player ranks}
In LoL, players can compete in ranked games, where they are placed in one of 7 tiers. Better players achieve higher tiers.
Before a match starts, we have access to data about the highest tier each player has achieved in a ranked game, which we will refer to as the rank of a player. We also know if a player has not competed in ranked games, in which case we say that he is unranked.
A player can achieve one of the ranks \textit{bronze}, \textit{silver}, \textit{gold}, \textit{platinum}, \textit{diamond}, \textit{master}, \textit{challenger}, mentioned in increasing order of skills required to achieve the rank.
We define a score function $\varphi : P \rightarrow \mathcal{N}$, where $\varphi(p) = 0$ if $p$ is unranked, or $1, 2, \dots, 7$ if $p$ has rank \textit{bronze}, \textit{silver}, $\dots$, \textit{challenger} respectively.
We define the rank of a team to be the average rank of all players on that team who is not unranked:
\begin{equation}\label{eq:eta}
\eta(t) = \frac{\sum\limits_{(p, c) \in t} \varphi(p)}{|\{(p, c) \in t \mid \varphi(p) > 0\}|}
\end{equation}
which we use to define a single feature
\begin{equation}\label{eq:bestrank}
\phi_\text{BEST-RANK}(x) = 
\begin{cases} 
  1 & \text{if } \eta(T_\text{blue}(x)) > \eta(T_\text{purple}(x))\\
  -1 & \text{if } \eta(T_\text{blue}(x)) < \eta(T_\text{blue}(x))\\
  0 & \text{otherwise} 
\end{cases}  
\end{equation}

The $\phi_\text{BEST-RANK}$ feature may have some shortcomings. The assumption that the rank of each player can be mapped to a score on a linear scale may not be entirely on spot.
Also, it may be easier to predict one team to be a winner, if the average rank of the two teams are considerably different. That is, if the players on one of the team have much greater ranks in average. The difference between the average rank of each team is not captured by the $\phi_\text{BEST-RANK}$ feature.
Therefore, another type of feature is introduced that captures the exact rank of each player.
$\forall(p, c) \in T_\text{blue}(x) \cup T_\text{purple}(x)$:
\begin{equation}\label{eq:playerrank}
\phi_{\text{PLAYER-RANK},p}(x) = S(p)  
\end{equation}

In the early stage of a match, players tend to keep their champion in the same lane.
If a good player plays against a bad player in the same lane, the good player might get so strong, that the good player is able to carry the team to victory.
To define a new feature that considers the rank of players that play against each other in the same lane,
we first define a function that given a lane and a team returns the rank(s) of the players(s) playing that lane on the given team.
$\forall l \in L, \forall t \in T(x)$:
\begin{equation}\label{eq:xi}
  \xi(t,l) =
\begin{cases} 
  \text{none} & \text{if } \forall(c, p) \in t: c \text{ does not play in lane } l. \\
  r_1 & \text{if only } (c_1, p_1) \in t \text{ plays lane } l \text{ and } p_1 \text{ has rank } r_1 \text{.}\\
  (r_1, r_2) & \text{if only } (c_1, p_1), (c_2, p_2) \in t \text{ plays lane } l, \text{ where } p_1, p_2 \text{ has rank } r_1, r_2\\ 
&\text{respectively, and } p_1 \neq p_2.\\
  \text{many} & \text{otherwise}.
\end{cases}
\end{equation}
Note that if more than two players on the same team plays the same lane, $\xi$ does not capture any ranks for that team and lane. This is because of the huge amount of combinations and the fact that playing 3 champions in the same lane is a very bad strategy. Therefore, we think a single feature is enough to capture all the bad strategies of having 3 champions in the same lane.
 
The function $\xi$ is now used to define a new feature that captures the rank of players playing in each lane.
$\forall l \in L$, and for any $a,b$ that are possibles values in the range of $\xi$:
\begin{equation}\label{eq:laneranks}
\phi_{\text{LANE-RANKS},l,a,b}(x) =
\begin{cases} 
  1 & \text{if } \xi(T_\text{BLUE}(x),l) = a, \xi(T_\text{PURPLE}(x),l) = b\\
  0 & \text{otherwise} 
\end{cases}  
\end{equation}


\subsubsection{Champion lanes}
Some champions are better suited for a particular lane. For instance, mages tend to go mid as they generally loose both mana and health fast, and the path back to the base for regeneration is shortest from mid. To capture the lane each champion play, we define a new feature.
$\forall l \in L, \forall(p, c) \in T_\text{blue}(x) \cup T_\text{purple}(x)$:
\begin{equation}\label{eq:championlane}
  \phi_{\text{LANE-CHAMPION},c,l}(x) =
\begin{cases} 
  1 & \text{if champion } c \text{ fought at lane } l)\\
  0 & \text{otherwise} 
\end{cases}
\end{equation}

\subsection{Feature sparsity}\label{sec:featuresparsity}
All of the introduced features can have value of either 1 or 0. If a feature has a value of $1$ in a given match, we say that the given feature \textit{appear} in that match.
For a given match, a dense representation of features is a list of values, such that the $i$'th value denotes the value of feature $i$.
A sparse representation is a list of indices $i$ of all features that appear in the given match.
If there in general only appear very few of the possible features in any given match, a sparse representation may be more memory efficient and hence provide better performance  and thus be favourable.

Each team can choose from $|C|$ different champions. Therefore:
\[\phi_{\text{SINGLE}} = |T(x)| \cdot |C| = 2 \cdot 124 = 248\] 
In each match, only $2 \cdot 5 = 10$ of those features appear.

There are $|C| \cdot (|C|-1)$ different 2-combinations of champions. Therefore:
\[\phi_{\text{PAIR}} = |T(x)| \cdot |C| \cdot (|C|-1) / 2 = 2 \cdot 124 \cdot 123 / 2 = 15252\] 
In each match, only $2 \cdot 5 \cdot 4 / 2 = 20$ of those features appear.

Both teams can choose from $|C|$ different champions. Therefore:
\[\phi_{\text{COUNTER}} = |C|^2 = 124^2 = 15376\] 
In each match, only $5 \cdot 5 = 25$ of those features appear.

In each match, the best ranked team can either be blue, purple, or it can be a tie. Therefore:
\[\phi_{\text{BEST-RANK}} = 3\] 
By definition, each match contains only $1$ of those features.

Each of the $2$ teams have $5$ players that each can have $1$ of $8$ ranks:
\[\phi_{\text{PLAYER-RANK}} = 2 \cdot 5 \cdot 8 = 80\] 
Since every player has only $1$ rank, only $10$ of those features appear.

Each lane contains either none, 1, 2, or many champions from each team. The exact ranks are only considered for a given team and lane if the team has either 1 or 2 champions in a given lane. Therefore:
\[\phi_{\text{LANE-RANKS}} = |L| \cdot (1 + |R| + |R|^2 + 1)^2 = 21904\]
In each match only $5$ of these features appear, as each of the lanes has exactly one combination of ranks of the players / champions playing against each other.

For each team, every champion can be in one of 4 lanes. Therefore, we get that:
\[\phi_{\text{LANE-CHAMPION}} = |T(x)| \cdot |C| \cdot |L| = 2 \cdot 124 \cdot 4 = 992\]
In each match, only $2 \cdot 5 \cdot 4 = 40$ features appear.

  \begin{table}[!htb]
    \centering
    \scalebox{0.95}{
    \begin{tabular}{|l|ccc|}
      \hline
      Feature type                  & Domain size & Appears in a single match & Appeared in 60,000 matches \\ \hline
      $\phi_{\text{SINGLE}}$        & 248         & 10  & 248               \\ 
      $\phi_{\text{PAIR}}$          & 15252       & 20  & 15252             \\ 
      $\phi_{\text{COUNTER}}$       & 15376       & 25  & 15359             \\ 
      $\phi_{\text{BEST-RANK}}$     & 3           & 1   & 3                 \\ 
      $\phi_{\text{PLAYER-RANK}}$   & 80          & 10  & 80                \\ 
      $\phi_{\text{LANE-RANKS}}$    & 21904       & 5   & 1834              \\ 
      $\phi_{\text{LANE-CHAMPION}}$ & 992         & 40  & 992               \\
      Total                    & 53855       & 111 & 33768             \\ \hline
    \end{tabular}
  }
    \caption{The sparsity of each type of feature}\label{tab:featuresparsity}
  \end{table}

The calculated sparsities are shown in \Cref{tab:featuresparsity}, which also includes how many of each type of feature that appeared in 60,000 matches.
In total, only $0.2\%$ of the possible features appear in a single game, hence we choose a sparse representation of features. This is important because of the memory limitation, which will be present on the cluster which we have set up described in \Cref{sec:cluster}. 